<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bulk-print-js æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section { 
            background: #f5f5f5; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
            border: 1px solid #ddd;
        }
        
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover { 
            background: #0056b3; 
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        button.danger { 
            background: #dc3545; 
        }
        
        button.danger:hover { 
            background: #c82333; 
        }
        
        .status { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        
        .progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry { 
            margin: 5px 0; 
            padding: 5px; 
            border-radius: 3px; 
        }
        
        .log-success { 
            background: #d4edda; 
            color: #155724; 
        }
        
        .log-error { 
            background: #f8d7da; 
            color: #721c24; 
        }
        
        .log-info { 
            background: #d1ecf1; 
            color: #0c5460; 
        }
        
        .log-warning { 
            background: #fff3cd; 
            color: #856404; 
        }
        
        .print-page { 
            border: 2px solid #333; 
            margin: 20px 0; 
            padding: 20px; 
            page-break-after: always;
            display: none; /* é»˜è®¤éšè— */
            background: white;
        }
        
        .print-page h2 {
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .stats { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item { 
            text-align: center; 
            padding: 10px; 
            background: #e9ecef; 
            border-radius: 4px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
        }
        
        @media print {
            body { margin: 0; }
            .test-section, button, .log, .status, .stats { 
                display: none; 
            }
            .print-page { 
                display: block !important; 
                border: none; 
                margin: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¨ï¸ bulk-print-js æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š æ‰“å°çŠ¶æ€</h3>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalPages">0</div>
                    <div class="stat-label">æ€»é¡µæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentBatch">0</div>
                    <div class="stat-label">å½“å‰æ‰¹æ¬¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalBatches">0</div>
                    <div class="stat-label">æ€»æ‰¹æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="progress">0%</div>
                    <div class="stat-label">è¿›åº¦</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="isPrinting">å¦</div>
                    <div class="stat-label">æ‰“å°ä¸­</div>
                </div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
            <button onclick="testSmallPrint()">å°æ‰¹é‡æ‰“å° (5é¡µ)</button>
            <button onclick="testBatchPrint()">åˆ†æ‰¹æ‰“å° (15é¡µ)</button>
            <button onclick="testLargePrint()">å¤§æ‰¹é‡æ‰“å° (50é¡µ)</button>
            <button onclick="cancelPrint()" class="danger" id="cancelBtn" disabled>å–æ¶ˆæ‰“å°</button>
            <button onclick="clearLog()" class="danger">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æ“ä½œæ—¥å¿—</h3>
            <div class="log" id="log"></div>
        </div>

        <!-- æ‰“å°å†…å®¹åŒºåŸŸ -->
        <div id="print-container">
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 1</h2>
                <p>è¿™æ˜¯ç¬¬ä¸€é¡µçš„æµ‹è¯•å†…å®¹ã€‚bulk-print-js æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ‰¹é‡æ‰“å°è§£å†³æ–¹æ¡ˆã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•æ‰¹é‡æ‰“å°åŠŸèƒ½çš„åŸºæœ¬æ•ˆæœã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 2</h2>
                <p>è¿™æ˜¯ç¬¬äºŒé¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æµ‹è¯•å†…å®¹ï¼šæ”¯æŒè‡ªå®šä¹‰é¡µé¢é€‰æ‹©å™¨å’Œæ‰¹æ¬¡å¤§å°é…ç½®ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 3</h2>
                <p>è¿™æ˜¯ç¬¬ä¸‰é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>ç‰¹æ€§ï¼šæ™ºèƒ½åˆ†æ‰¹å¤„ç†ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 4</h2>
                <p>è¿™æ˜¯ç¬¬å››é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>ä¼˜åŠ¿ï¼šè·¨æµè§ˆå™¨å…¼å®¹ï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 5</h2>
                <p>è¿™æ˜¯ç¬¬äº”é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>åº”ç”¨åœºæ™¯ï¼šæŠ¥è¡¨æ‰“å°ã€æ–‡æ¡£æ‰¹é‡è¾“å‡ºã€ç¥¨æ®æ‰“å°ç­‰ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 6</h2>
                <p>è¿™æ˜¯ç¬¬å…­é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>åŠŸèƒ½ï¼šå®æ—¶è¿›åº¦ç›‘æ§ï¼Œé”™è¯¯æ¢å¤æœºåˆ¶ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 7</h2>
                <p>è¿™æ˜¯ç¬¬ä¸ƒé¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>é…ç½®ï¼šçµæ´»çš„æ‰¹æ¬¡å¤§å°å’Œé˜ˆå€¼è®¾ç½®ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 8</h2>
                <p>è¿™æ˜¯ç¬¬å…«é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æ€§èƒ½ï¼šä¼˜åŒ–çš„å†…å­˜ç®¡ç†å’ŒDOMæ“ä½œã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 9</h2>
                <p>è¿™æ˜¯ç¬¬ä¹é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æ˜“ç”¨ï¼šç®€å•çš„APIè®¾è®¡ï¼Œå¿«é€Ÿé›†æˆã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 10</h2>
                <p>è¿™æ˜¯ç¬¬åé¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æµ‹è¯•å®Œæˆï¼æ„Ÿè°¢ä½¿ç”¨ bulk-print-jsã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 11</h2>
                <p>è¿™æ˜¯ç¬¬åä¸€é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>é¢å¤–é¡µé¢ç”¨äºæµ‹è¯•å¤§æ‰¹é‡æ‰“å°åŠŸèƒ½ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 12</h2>
                <p>è¿™æ˜¯ç¬¬åäºŒé¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>éªŒè¯åˆ†æ‰¹æ‰“å°çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 13</h2>
                <p>è¿™æ˜¯ç¬¬åä¸‰é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>æµ‹è¯•ä¸åŒæ‰¹æ¬¡å¤§å°çš„å¤„ç†æ•ˆæœã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 14</h2>
                <p>è¿™æ˜¯ç¬¬åå››é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>éªŒè¯äº‹ä»¶ç³»ç»Ÿçš„å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§ã€‚</p>
            </div>
            <div class="print-page">
                <h2>æµ‹è¯•é¡µé¢ 15</h2>
                <p>è¿™æ˜¯ç¬¬åäº”é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                <p>æ—¶é—´: <span class="timestamp"></span></p>
                <p>åˆ†æ‰¹æ‰“å°æµ‹è¯•å®Œæˆã€‚</p>
            </div>
        </div>
    </div>

    <script src="../dist/bulk-print.umd.js"></script>
    <script>
        let printer = null;
        let isPrinting = false;

        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStatus() {
            if (printer) {
                const stats = printer.getStatus();
                document.getElementById('totalPages').textContent = stats.totalPages || 0;
                document.getElementById('currentBatch').textContent = stats.currentBatch || 0;
                document.getElementById('totalBatches').textContent = stats.totalBatches || 0;
                document.getElementById('progress').textContent = `${stats.progress || 0}%`;
                document.getElementById('isPrinting').textContent = stats.isPrinting ? 'æ˜¯' : 'å¦';
                
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${stats.progress || 0}%`;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('cancelBtn').disabled = !stats.isPrinting;
                isPrinting = stats.isPrinting;
            }
        }

        function updateTimestamps() {
            document.querySelectorAll('.timestamp').forEach(el => {
                el.textContent = new Date().toLocaleString();
            });
        }

        async function testSmallPrint() {
            if (isPrinting) {
                log('âš ï¸ æ‰“å°æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'warning');
                return;
            }

            log('ğŸ§ª å¼€å§‹å°æ‰¹é‡æ‰“å°æµ‹è¯• (5é¡µ)', 'info');
            try {
                printer = new BulkPrint({
                    pageSelector: '.print-page',
                    threshold: 10
                });

                printer.on('start', (data) => {
                    log(`ğŸš€ å¼€å§‹æ‰“å°: ${data.totalPages}é¡µï¼Œåˆ†${data.totalBatches}æ‰¹`, 'success');
                    updateStatus();
                });

                printer.on('batchStart', (data) => {
                    log(`ğŸ“¦ å¼€å§‹ç¬¬ ${data.batch}/${data.totalBatches} æ‰¹ (${data.pagesInBatch}é¡µ)`, 'info');
                    updateStatus();
                });

                printer.on('batchComplete', (data) => {
                    log(`âœ… ç¬¬ ${data.batch} æ‰¹å®Œæˆ`, 'success');
                    updateStatus();
                });

                const result = await printer.print({
                    element: document.getElementById('print-container'),
                    totalPages: 5
                });

                if (result.success) {
                    log(`ğŸ‰ å°æ‰¹é‡æ‰“å°å®Œæˆï¼å…±æ‰“å° ${result.pages} é¡µ`, 'success');
                }
            } catch (error) {
                log(`âŒ å°æ‰¹é‡æ‰“å°å¤±è´¥: ${error.message}`, 'error');
            }
            updateStatus();
        }

        async function testBatchPrint() {
            if (isPrinting) {
                log('âš ï¸ æ‰“å°æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'warning');
                return;
            }

            log('ğŸ§ª å¼€å§‹åˆ†æ‰¹æ‰“å°æµ‹è¯• (15é¡µ)', 'info');
            try {
                printer = new BulkPrint({
                    pageSelector: '.print-page',
                    threshold: 10,
                    batchSize: 5
                });

                printer.on('start', (data) => {
                    log(`ğŸš€ å¼€å§‹åˆ†æ‰¹æ‰“å°: ${data.totalPages}é¡µï¼Œåˆ†${data.totalBatches}æ‰¹ï¼Œæ¯æ‰¹${data.batchSize}é¡µ`, 'success');
                    updateStatus();
                });

                printer.on('batchStart', (data) => {
                    log(`ğŸ“¦ å¼€å§‹ç¬¬ ${data.batch}/${data.totalBatches} æ‰¹ï¼Œä»ç¬¬${data.startPage}é¡µå¼€å§‹`, 'info');
                    updateStatus();
                });

                printer.on('batchComplete', (data) => {
                    log(`âœ… ç¬¬ ${data.batch} æ‰¹å®Œæˆ`, 'success');
                    updateStatus();
                });

                const result = await printer.print({
                    element: document.getElementById('print-container'),
                    totalPages: 15
                });

                if (result.success) {
                    log(`ğŸ‰ åˆ†æ‰¹æ‰“å°å®Œæˆï¼å…±æ‰“å° ${result.pages} é¡µ`, 'success');
                }
            } catch (error) {
                log(`âŒ åˆ†æ‰¹æ‰“å°å¤±è´¥: ${error.message}`, 'error');
            }
            updateStatus();
        }

        async function testLargePrint() {
            if (isPrinting) {
                log('âš ï¸ æ‰“å°æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'warning');
                return;
            }

            // ç”Ÿæˆé¢å¤–çš„æµ‹è¯•é¡µé¢
            const container = document.getElementById('print-container');
            const currentPages = container.querySelectorAll('.print-page').length;
            
            for (let i = currentPages + 1; i <= 50; i++) {
                const page = document.createElement('div');
                page.className = 'print-page';
                page.innerHTML = `
                    <h2>æµ‹è¯•é¡µé¢ ${i}</h2>
                    <p>è¿™æ˜¯ç¬¬${i}é¡µçš„æµ‹è¯•å†…å®¹ã€‚</p>
                    <p>æ—¶é—´: <span class="timestamp"></span></p>
                    <p>å¤§æ‰¹é‡æ‰“å°æµ‹è¯•é¡µé¢ ${i}ã€‚</p>
                `;
                container.appendChild(page);
            }

            log('ğŸ§ª å¼€å§‹å¤§æ‰¹é‡æ‰“å°æµ‹è¯• (50é¡µ)', 'info');
            try {
                printer = new BulkPrint({
                    pageSelector: '.print-page',
                    threshold: 20,
                    batchSize: 10
                });

                printer.on('start', (data) => {
                    log(`ğŸš€ å¼€å§‹å¤§æ‰¹é‡æ‰“å°: ${data.totalPages}é¡µï¼Œåˆ†${data.totalBatches}æ‰¹`, 'success');
                    updateStatus();
                });

                printer.on('batchStart', (data) => {
                    log(`ğŸ“¦ å¼€å§‹ç¬¬ ${data.batch}/${data.totalBatches} æ‰¹ (${data.pagesInBatch}é¡µ)`, 'info');
                    updateStatus();
                });

                printer.on('batchComplete', (data) => {
                    log(`âœ… ç¬¬ ${data.batch} æ‰¹å®Œæˆ`, 'success');
                    updateStatus();
                });

                const result = await printer.print({
                    element: document.getElementById('print-container'),
                    totalPages: 50
                });

                if (result.success) {
                    log(`ğŸ‰ å¤§æ‰¹é‡æ‰“å°å®Œæˆï¼å…±æ‰“å° ${result.pages} é¡µ`, 'success');
                }
            } catch (error) {
                log(`âŒ å¤§æ‰¹é‡æ‰“å°å¤±è´¥: ${error.message}`, 'error');
            }
            updateStatus();
        }

        function cancelPrint() {
            if (printer && isPrinting) {
                const wasCancelled = printer.cancel();
                if (wasCancelled) {
                    log('â¹ï¸ æ‰“å°å·²å–æ¶ˆ', 'warning');
                } else {
                    log('âš ï¸ æ— æ³•å–æ¶ˆæ‰“å°', 'warning');
                }
            }
            updateStatus();
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('ğŸ“ æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateTimestamps();
            log('ğŸš€ bulk-print-js æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            log('ğŸ“‹ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
            updateStatus();
        });
    </script>
</body>
</html>